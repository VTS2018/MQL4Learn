//+------------------------------------------------------------------+
//| ä¿¡å·å¼±åŠ¿è¿‡æ»¤ï¼šæ£€æŸ¥çœ‹æ¶¨ä¿¡å·çš„ SL (ä½ç‚¹) æ˜¯å¦æŠ¬å‡                 |
//| è¿”å›å€¼ï¼šè¿‡æ»¤åæœ‰æ•ˆä¿¡å·çš„æ•°é‡ã€‚                                   |
//| å‚æ•°1 (source_signals): åŸå§‹ä¿¡å·åˆ—è¡¨ (æŒ‰å€¼å¤åˆ¶)                  |
//| å‚æ•°2 (&filtered_list): è¿‡æ»¤åçš„ç»“æœæ•°ç»„ (é€šè¿‡å¼•ç”¨å¡«å……)          |
//+------------------------------------------------------------------+
int FilterWeakBullishSignals(FilteredSignal source_signals[], FilteredSignal &filtered_list[])
{
    // 1. ç¡®ä¿ç»“æœæ•°ç»„ä¸ºç©ºï¼Œå‡†å¤‡å¡«å……
    ArrayResize(filtered_list, 0); 
    
    int size = ArraySize(source_signals);
    
    // 2. å¤„ç†è¾¹ç¼˜æƒ…å†µï¼šå¦‚æœä¿¡å·å°‘äº 2 ä¸ªï¼Œæ— éœ€è¿‡æ»¤
    if (size < 2)
    {
        // ç›´æ¥å°†åŸå§‹ä¿¡å·å¤åˆ¶åˆ°ç»“æœæ•°ç»„ä¸­
        ArrayCopy(filtered_list, source_signals);
        return ArraySize(filtered_list);
    }
    
    // 3. æ ¸å¿ƒè¿‡æ»¤é€»è¾‘å¼€å§‹
    
    // ä»æœ€æ—§çš„ä¿¡å·å¼€å§‹æ¯”è¾ƒã€‚æœ€æ—§çš„ä¿¡å·åœ¨æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚
    int last_index = size - 1;
    
    // 3.1 å‡è®¾æœ€æ—§çš„ä¿¡å·ï¼ˆä¿¡å· B - æœ€è¿œç¦» K[1]ï¼‰æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œå°†å…¶åŠ å…¥ç»“æœåˆ—è¡¨
    ArrayResize(filtered_list, 1);
    filtered_list[0] = source_signals[last_index]; 
    
    // 3.2 é€†åºéå†ï¼šä»å€’æ•°ç¬¬äºŒä¸ªä¿¡å·å¼€å§‹ï¼Œå‘å‰æ¯”è¾ƒ (ä¿¡å· A - æ›´é è¿‘ K[1])
    for (int i = last_index - 1; i >= 0; i--)
    {
        FilteredSignal current_signal = source_signals[i];   // ä¿¡å· A (æ–°çš„ï¼Œshift æ›´å°)
        FilteredSignal previous_valid = filtered_list[ArraySize(filtered_list) - 1]; // ä¸Šä¸€ä¸ªæœ‰æ•ˆä¿¡å· (æ—§çš„ï¼Œshift æ›´å¤§)
        
        // -------------------------------------------------------------
        // ğŸš¨ è¿‡æ»¤è§„åˆ™ (çœ‹æ¶¨ä¿¡å·å¼±åŠ¿åˆ¤æ–­) ğŸš¨
        // çœ‹æ¶¨è¦æ±‚ï¼šä½ç‚¹ (SL) å¿…é¡»æŠ¬å‡ã€‚
        // å¦‚æœå½“å‰ä¿¡å·çš„æ­¢æŸä»· (SL) å°äºæˆ–ç­‰äºå‰ä¸€ä¸ªæœ‰æ•ˆä¿¡å·çš„æ­¢æŸä»· (SL)ï¼Œ
        // åˆ™è¡¨æ˜ä»·æ ¼ä½ç‚¹è¢«ç ´åæˆ–æœªæŠ¬å‡ï¼Œè§†ä¸ºæ— æ•ˆä¿¡å·ã€‚
        // -------------------------------------------------------------
        
        if (current_signal.stop_loss <= previous_valid.stop_loss)
        {
            // Print("âŒ å¼±åŠ¿è¿‡æ»¤ (çœ‹æ¶¨): ä¿¡å· @ ", TimeToString(current_signal.signal_time), " æœªèƒ½æŠ¬å‡ä½ç‚¹ï¼Œè¿‡æ»¤æ‰ã€‚");
            continue; // è¿‡æ»¤æ‰ä¿¡å· A
        }

        // ä¿¡å· A é€šè¿‡è¿‡æ»¤ï¼šå°†å…¶åŠ å…¥æœ‰æ•ˆåˆ—è¡¨
        int new_index = ArraySize(filtered_list);
        ArrayResize(filtered_list, new_index + 1);
        filtered_list[new_index] = current_signal;
    }
    
    // 4. é€†è½¬æ•°ç»„ï¼šå½“å‰ filtered_list æ˜¯ä»æ—§åˆ°æ–°æ’åˆ—çš„ï¼Œå°†å…¶é€†è½¬ä¸ºä»æ–°åˆ°æ—§ (K[1] çš„ä¿¡å·æ’åœ¨æœ€å‰)
    ArrayReverse(filtered_list); 
    
    // 5. è¿”å›æœ€ç»ˆæœ‰æ•ˆçš„ä¿¡å·æ•°é‡
    return ArraySize(filtered_list);
}