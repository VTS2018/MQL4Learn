//+------------------------------------------------------------------+
//| æ”¶é›†æ‰€æœ‰åˆæ ¼ä¿¡å·ï¼šæ‰«æå†å²Kçº¿å¹¶åˆ†ç¦»çœ‹æ¶¨å’Œçœ‹è·Œä¿¡å·                |
//| @param bullish_list: å¼•ç”¨ - å­˜å‚¨çœ‹æ¶¨ä¿¡å·åˆ—è¡¨                    |
//| @param bearish_list: å¼•ç”¨ - å­˜å‚¨çœ‹è·Œä¿¡å·åˆ—è¡¨                    |
//+------------------------------------------------------------------+
void CollectAllSignals_V1(FilteredSignal &bullish_list[], FilteredSignal &bearish_list[])
{
    // 1. æ¸…ç©ºæ•°ç»„ï¼Œå‡†å¤‡é‡æ–°æ”¶é›†
    ArrayResize(bullish_list, 0); 
    ArrayResize(bearish_list, 0); 

    // -----------------------------------------------------------
    // ğŸš¨ æ ¸å¿ƒä¿®æ­£ 1ï¼šè·å–ç°ä»·åŸºå‡† (ä½¿ç”¨å½“å‰ K çº¿çš„æ”¶ç›˜ä»·)
    // Close[0] ä»£è¡¨å½“å‰æ­£åœ¨å½¢æˆçš„ K çº¿çš„æ”¶ç›˜ä»·ï¼ˆæˆ–æœ€æ–°çš„ä»·æ ¼ï¼‰
    // -----------------------------------------------------------
    double current_price = Close[0];

    // 2. å¼€å§‹æ‰«æï¼šä» K[1] å¾€å†å²å·¦ä¾§æ‰«æ
    for (int shift = 1; shift <= Indi_LastScan_Range; shift++)
    {
        // A. æ‰¹é‡è¯»å–æ‰€æœ‰ç¼“å†²åŒºæ•°æ® (å‡è®¾ GetIndicatorBarData å¯ç”¨)
        KBarSignal data = GetIndicatorBarData(shift); 
        
        // -----------------------
        // æ£€æŸ¥çœ‹æ¶¨ä¿¡å·
        // -----------------------
        if (data.BullishReferencePrice != (double)EMPTY_VALUE && 
            (int)data.BullishReferencePrice >= Min_Signal_Quality &&
            data.BullishStopLossPrice != (double)EMPTY_VALUE && data.BullishStopLossPrice != 0.0)
        {

            // --------------------------------------------------------
            // ğŸš¨ æ ¸å¿ƒä¿®æ­£ 2ï¼šçœ‹æ¶¨ä¿¡å·ä»·æ ¼åŒºä½è¿‡æ»¤ (ä¿¡å·ä»·å¿…é¡»ä½äºç°ä»·)
            // æˆ‘ä»¬ä½¿ç”¨ä¿¡å·çš„ç¡®è®¤æ”¶ç›˜ä»· (Close[shift]) ä½œä¸ºå…¶â€œä»·æ ¼â€çš„ä»£è¡¨
            // ä¸ºä»€ä¹ˆåŠ å…¥è¿™ä¸ªåˆ¤æ–­ï¼Ÿå°±æ˜¯ä¸ºäº†ä¿è¯ æ‰¾åˆ°çš„ çœ‹æ¶¨ä¿¡å· ä¸€å®šæ˜¯å°äºç°ä»·çš„
            // å› ä¸º å¦‚æœæ‰«æåˆ° ã€é«˜äºç°ä»·çš„ å†å²åšå¤šä¿¡å·ã€‘ æ˜¯æ²¡æœ‰æ„ä¹‰çš„
            // æ‰«æåˆ°çš„çœ‹è·Œä¿¡å· åœ¨ç°ä»·çš„ä¸‹æ–¹ åˆ™æ²¡æœ‰æ„ä¹‰
            // è¿™é‡Œæœ€çº ç»“çš„ä¸¤ç‚¹ å°±æ˜¯ K[1] å¦‚æœæ˜¯ä¿¡å· è¯¥å¦‚ä½•å¤„ç†çš„é—®é¢˜ï¼Ÿ
            // å¦‚æœæˆ‘ä»¬ä¸åŠ åˆ¤æ–­ åˆ™ä¸€å®šèƒ½æ”¶é›†åˆ°K[1],ä½†æ˜¯ä¼šæœ‰æ— æ•ˆçš„å†å²ä¿¡å·æ··å…¥
            // å¦‚æœæˆ‘ä»¬åŠ äº†åˆ¤æ–­ åˆ™K[1] ä¿¡å·æœ‰å¯èƒ½ä¼šä¸¢å¤±æ‰ï¼Œå¦‚æ­¤åœ¨åç»­çš„ä¸Šä¸‹æ–‡è®¡ç®—æ—¶å°±ä¼šbug
            // ä¸Šä¸‹æ–‡çš„ç®—æ³• å°±æ˜¯å°†å½“å‰ç¡®è®¤ä¿¡å· å’Œ å†å²ç›¸å¯¹æ¯”
            // è¿™å°±è¦è€ƒè™‘ è¦ä¸è¦ è‡ªå·±å’Œè‡ªå·±å¯¹æ¯”çš„é—®é¢˜
            // --------------------------------------------------------

            if (Close[shift] < current_price)
            {
               int current_size = ArraySize(bullish_list);
               ArrayResize(bullish_list, current_size + 1);

               bullish_list[current_size].shift = shift;
               bullish_list[current_size].signal_time = data.OpenTime;
               bullish_list[current_size].confirmation_close = Close[shift];
               bullish_list[current_size].stop_loss = data.BullishStopLossPrice;
               bullish_list[current_size].type = OP_BUY;
            }
        }
        
        // -----------------------
        // æ£€æŸ¥çœ‹è·Œä¿¡å·
        // -----------------------
        if (data.BearishReferencePrice != (double)EMPTY_VALUE && 
            (int)data.BearishReferencePrice >= Min_Signal_Quality &&
            data.BearishStopLossPrice != (double)EMPTY_VALUE && data.BearishStopLossPrice != 0.0)
        {

            // --------------------------------------------------------
            // ğŸš¨ æ ¸å¿ƒä¿®æ­£ 3ï¼šçœ‹è·Œä¿¡å·ä»·æ ¼åŒºä½è¿‡æ»¤ (ä¿¡å·ä»·å¿…é¡»é«˜äºç°ä»·)
            // --------------------------------------------------------

            if (Close[shift] > current_price)
            {
               int current_size = ArraySize(bearish_list);
               ArrayResize(bearish_list, current_size + 1);

               bearish_list[current_size].shift = shift;
               bearish_list[current_size].signal_time = data.OpenTime;
               bearish_list[current_size].confirmation_close = Close[shift];
               bearish_list[current_size].stop_loss = data.BearishStopLossPrice;
               bearish_list[current_size].type = OP_SELL;
            }
        }
    }
}