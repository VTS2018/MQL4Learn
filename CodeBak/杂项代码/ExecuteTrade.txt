// KTarget_FinderBot.mq4

// ğŸš¨ ä¿®æ­£åçš„å‡½æ•°ç­¾åï¼šå¢åŠ  entry_price å‚æ•° ğŸš¨
void ExecuteTrade(int type, double lots, double sl, double tp, double entry_price, string comment)
{
    // 1. è§„èŒƒåŒ–ä»·æ ¼
    sl = NormalizeDouble(sl, _Digits);
    tp = NormalizeDouble(tp, _Digits);
    
    // 2. ç¡®å®šå®é™…å¼€ä»“ä»· (ä»ç„¶ä½¿ç”¨å¸‚ä»· Ask/Bid)
    double open_price = (type == OP_BUY) ? Ask : Bid;
    open_price = NormalizeDouble(open_price, _Digits);
    
    // ğŸš¨ 3. å¯é€‰ï¼šæ»‘ç‚¹æ£€æŸ¥ (å¦‚æœå®é™…å¼€ä»“ä»· open_price åç¦»é¢„æœŸå…¥åœºä»· entry_price å¤ªè¿œï¼Œåˆ™æ‹’ç»äº¤æ˜“)
    /*
    if (MathAbs(open_price - entry_price) > Max_Allowed_Slippage * Point())
    {
        Print("äº¤æ˜“è¢«æ‹’ç»: å®é™…å¼€ä»“ä»· (", open_price, ") æ»‘ç‚¹è¿‡å¤§ï¼Œé¢„æœŸä»· (", entry_price, ")");
        return;
    }
    */
    
    // 4. å‘é€è®¢å• (ä½¿ç”¨ Ask/Bid ä½œä¸ºå¸‚ä»·å• price)
    int ticket = OrderSend(_Symbol, 
                           type, 
                           lots, 
                           open_price, // å®é™…å¼€ä»“ä»·
                           Slippage,   // ä½¿ç”¨ input å®šä¹‰çš„æ»‘ç‚¹
                           sl, 
                           tp, 
                           comment, 
                           MagicNumber, 
                           0, 
                           (type == OP_BUY) ? clrGreen : clrRed); 
                           
    // 5. ç»“æœæ£€æŸ¥ (ä½¿ç”¨ _Symbol æ›¿ä»£ Symbol()ï¼Œä½¿ç”¨ _Digits æ›¿ä»£ Digits)
    if(ticket > 0)
    {
        Print("è®¢å•æ‰§è¡ŒæˆåŠŸ! Ticket: ", ticket, " ç±»å‹: ", (type==OP_BUY?"BUY":"SELL"), " SL: ", sl, " TP: ", tp);
    }
    else
    {
        Print("è®¢å•æ‰§è¡Œå¤±è´¥! é”™è¯¯ä»£ç : ", GetLastError(), ", é¢„æœŸå…¥åœºä»·: ", entry_price);
    }
}