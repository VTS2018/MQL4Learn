//+------------------------------------------------------------------+
//| è¾…åŠ©å‡½æ•°ï¼šç”Ÿæˆç»å¯¹å”¯ä¸€çš„ä¿¡å· ID (å“ç§å‰ç¼€_æœˆæ—¥_æ—¶åˆ†)             |
//+------------------------------------------------------------------+
string GenerateSignalID(datetime signal_time)
{
   // --- å®šä¹‰è¾…åŠ©å˜é‡ (ç”¨äº StringReplaceï¼Œé¿å…æ­§ä¹‰) ---
   // å¿…é¡»ä½¿ç”¨è¿æ¥æ¥ç¡®ä¿ MQL4 ç¼–è¯‘å™¨å°†å…¶è¯†åˆ«ä¸ºæ˜ç¡®çš„ string
   string find_underscore = "_" + "";
   string find_dot = "." + "";
   string find_colon = ":" + "";
   string replace_empty = "" + "";

   // 1. è·å–å“ç§å‰ç¼€ (ä¾‹å¦‚: BTCUSD -> BTC)
   string symbol_prefix = _Symbol;
   if (StringLen(_Symbol) >= 3)
   {
      symbol_prefix = StringSubstr(_Symbol, 0, 3); // æˆªå–å‰ 3 ä¸ªå­—ç¬¦
   }

   // 2. æ¸…ç†å“ç§åä¸­çš„ä¸‹åˆ’çº¿/ç‚¹
   // å°† symbol_prefix èµ‹å€¼ç»™ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œä»¥ä¾¿ StringReplace è¿›è¡Œä¿®æ”¹ (å¼•ç”¨ä¼ é€’)
   string temp_symbol = symbol_prefix;

   // ğŸš¨ å…³é”®ä¿®æ­£ï¼šStringReplace ä»…ä½œå‡½æ•°è°ƒç”¨ï¼Œä¸èµ‹å€¼ç»™ string å˜é‡ ğŸš¨
   StringReplace(temp_symbol, find_underscore, replace_empty); // æ­£ç¡®ç”¨æ³•ï¼šä¿®æ”¹ temp_symbol
   StringReplace(temp_symbol, find_dot, replace_empty);        // æ­£ç¡®ç”¨æ³•ï¼šä¿®æ”¹ temp_symbol

   // ----------------------------------------------------
   // 3. ä¿®æ­£æ—¥æœŸ/æ—¶é—´è·å–é€»è¾‘
   // ----------------------------------------------------

   // 3.1 è·å–å®Œæ•´æ—¥æœŸ: "yyyy.mm.dd" (ä½¿ç”¨ TIME_DATE ç¡®ä¿æ ¼å¼æ ‡å‡†)
   string full_date = TimeToString(signal_time, TIME_DATE);

   // 3.2 æˆªå–æœˆæ—¥éƒ¨åˆ†: ä»ç¬¬ 5 ä½å¼€å§‹ï¼Œé•¿åº¦ä¸º 5 ("mm.dd")
   // æ ¼å¼ï¼š yyyy.mm.dd
   // ç´¢å¼•ï¼š 0123456789
   string month_day = StringSubstr(full_date, 5, 5);

   // 3.3 è·å–æ—¶é—´: "hh:mi"
   string hour_minute = TimeToString(signal_time, TIME_MINUTES);

   // 4. æ¸…ç†æ—¥æœŸæ—¶é—´åˆ†éš”ç¬¦ (ä½¿ç”¨ä¸´æ—¶å˜é‡æ¥å¤„ç† TimeToString çš„ç»“æœ)
   string temp_month_day = month_day;
   string temp_hour_minute = hour_minute;

   // ğŸš¨ å…³é”®ä¿®æ­£ï¼šStringReplace ä»…ä½œå‡½æ•°è°ƒç”¨ ğŸš¨
   StringReplace(temp_month_day, find_dot, replace_empty);
   StringReplace(temp_hour_minute, find_colon, replace_empty);

   // 5. æœ€ç»ˆ ID æ‹¼æ¥
   // æ ¼å¼: å“ç§å‰ç¼€_æœˆæ—¥_æ—¶åˆ† (ä¾‹å¦‚ï¼šXAU_1201_1517)
   return temp_symbol + "_" + temp_month_day + "_" + temp_hour_minute;
}