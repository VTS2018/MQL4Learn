//+------------------------------------------------------------------+
//| ä¿¡å·å¼±åŠ¿è¿‡æ»¤ (çœ‹è·Œ - æ–°é«˜ä¼˜èƒœé€»è¾‘)                              |
//| é€»è¾‘ï¼šNewer.Close > Older.SLï¼Œåˆ™ Older æ— æ•ˆ (è¢«æ¶¨ç ´)ã€‚           |
//+------------------------------------------------------------------+
int FilterWeakBearishSignals(FilteredSignal &source_signals[], FilteredSignal &filtered_list[])
{
    ArrayResize(filtered_list, 0);
    int total = ArraySize(source_signals);
    
    if (total == 0) return 0;

    // 1. ä¿ç•™æœ€æ–°ä¿¡å·
    ArrayResize(filtered_list, 1);
    filtered_list[0] = source_signals[0];

    // 2. è®¾å®šåˆå§‹æ¯”è¾ƒåŸºå‡†ï¼šä½¿ç”¨æœ€æ–°ä¿¡å·çš„ã€æ”¶ç›˜ä»·ã€‘
    double threshold_close = source_signals[0].confirmation_close;

    // 3. å‘å†å²æ–¹å‘éå†
    for (int i = 1; i < total; i++)
    {
        FilteredSignal older_signal = source_signals[i];
        
        // -------------------------------------------------------------
        // ğŸš¨ æ ¸å¿ƒé€»è¾‘ï¼šæ–°é«˜ä¼˜èƒœ ğŸš¨
        // çœ‹è·Œä¿¡å·çš„ SL æ˜¯æœ€é«˜ä»· (å‹åŠ›ä½)
        // -------------------------------------------------------------
        
        // æƒ…å†µ A: æ¶¨ç ´ (Invalidation)
        // å¦‚æœè¾ƒæ–°çš„ Close ä»·æ ¼ é«˜äº å†å²ä¿¡å·çš„ SL (æœ€é«˜ä»·)
        // è¯´æ˜æœ€æ–°çš„ä»·æ ¼å·²ç»åå‘çªç ´äº†è¯¥å†å²ä¿¡å·çš„å‹åŠ›ä½ï¼Œè¯¥å†å²ä¿¡å·å¤±æ•ˆã€‚
        if (threshold_close > older_signal.stop_loss)
        {
            // Print("âŒ è¿‡æ»¤ (çœ‹è·Œ): å†å²ä¿¡å· K[", older_signal.shift, "] SL:", older_signal.stop_loss, 
            //       " è¢«è¾ƒæ–°ä¿¡å· Close:", threshold_close, " æ¶¨ç ´ã€‚æ’é™¤ã€‚");
            continue;
        }

        // æƒ…å†µ B: å‹åŠ›æœ‰æ•ˆ (Validation)
        // è¾ƒæ–°çš„ Close ä¾ç„¶åœ¨ å†å²ä¿¡å· SL ä¹‹ä¸‹
        int new_index = ArraySize(filtered_list);
        ArrayResize(filtered_list, new_index + 1);
        filtered_list[new_index] = older_signal;

        // æ›´æ–°é˜ˆå€¼
        threshold_close = older_signal.confirmation_close;
    }

    return ArraySize(filtered_list);
}