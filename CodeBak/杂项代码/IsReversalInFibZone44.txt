//+------------------------------------------------------------------+
//| L2c: æ–æ³¢é‚£å¥‘åè½¬åŒºåŸŸè¿‡æ»¤ (Context Filter)                       |
//| æ£€æŸ¥å½“å‰åè½¬ä¿¡å· K çº¿ (High/Low) æ˜¯å¦è§¦ç¢°äº†å‰ä¸€ä¸ªè¶‹åŠ¿çš„è¡°ç«­åŒº      |
//+------------------------------------------------------------------+
bool IsReversalInFibZone(int current_shift, int current_type)
{
   // ... (ä»£ç å‰éƒ¨ä¸å˜ï¼šåˆå§‹åŒ– prev_dataï¼Œå¯»æ‰¾ found_prev_shiftï¼Œè®¡ç®— risk) ...

   // 5. æ£€æŸ¥é£é™©æ˜¯å¦æœ‰æ•ˆ (é˜²æ­¢é™¤ä»¥é›¶æˆ–é”™è¯¯è®¡ç®—)
   if (risk <= 0) 
   {
       // Print("å‰ç½®ä¿¡å·é£é™©è®¡ç®—æ— æ•ˆ (Risk <= 0)ã€‚");
       return false;
   }

   // 6. æ ¸å¿ƒä¿®æ”¹ï¼šéå†æ‰€æœ‰é¢„è®¾çš„æ–æ³¢é‚£å¥‘è¡°ç«­åŒºåŸŸ
   double current_high = High[current_shift]; // ğŸš¨ æ–°å¢ï¼šå½“å‰ä¿¡å·Kçº¿çš„æœ€é«˜ä»·
   double current_low  = Low[current_shift];  // ğŸš¨ æ–°å¢ï¼šå½“å‰ä¿¡å·Kçº¿çš„æœ€ä½ä»·
   double tolerance = risk * 0.1;               // è®¾ç½®å®¹å·® (ä¾‹å¦‚ 10% çš„ç†è®ºé£é™©è·ç¦»)
   
   // éå† FiboExhaustionZones æ•°ç»„
   for (int i = 0; i < FIBO_ZONES_COUNT; i++)
   {
       double level1 = FiboExhaustionZones[i].level1;
       double level2 = FiboExhaustionZones[i].level2;
       
       double zone_low = 0;
       double zone_high = 0;
       
       // 6.1 è®¡ç®—å½“å‰åŒºåŸŸçš„è¾¹ç•Œ
       if (search_type == OP_BUY)
       {
          // å‰ä¸€ä¸ªæ˜¯æ¶¨åŠ¿ï¼Œç›®æ ‡ä½åœ¨ä¸Šæ–¹ (çœ‹æ¶¨Fibï¼šä»·æ ¼éšçº§åˆ«å¢å¤§è€Œå¢å¤§)
          zone_low  = reference_price + (risk * level1);
          zone_high = reference_price + (risk * level2);
       }
       else
       {
          // å‰ä¸€ä¸ªæ˜¯è·ŒåŠ¿ï¼Œç›®æ ‡ä½åœ¨ä¸‹æ–¹ (çœ‹è·ŒFibï¼šä»·æ ¼éšçº§åˆ«å¢å¤§è€Œå‡å°)
          zone_low  = reference_price - (risk * level2); 
          zone_high = reference_price - (risk * level1);
       }
       
       // 6.2 ğŸš¨ æ ¸å¿ƒé€»è¾‘ä¿®æ”¹ï¼šæ£€æŸ¥ K çº¿æ˜¯å¦ä¸åŒºåŸŸæœ‰äº¤å‰ (è§¦ç¢°å³æœ‰æ•ˆ) ğŸš¨
       
       // æˆ‘ä»¬æ£€æŸ¥å½“å‰ K çº¿çš„ [Low, High] èŒƒå›´æ˜¯å¦ä¸åŒºåŸŸçš„ [zone_low, zone_high] èŒƒå›´æœ‰é‡å 
       bool is_touching = false;
       
       if (current_type == OP_SELL) // æ£€æŸ¥çœ‹è·Œä¿¡å·ï¼ˆä»·æ ¼ä»ä¸Šæ–¹è¿›å…¥æˆ–ç©¿è¿‡åŒºåŸŸï¼‰
       {
           // æ£€æŸ¥ï¼šKçº¿çš„ Low æ˜¯å¦ä½äºåŒºåŸŸçš„ High (å³è¿›å…¥åŒºåŸŸ)ï¼ŒåŒæ—¶ Kçº¿çš„ High å¿…é¡»é«˜äºåŒºåŸŸçš„ Low
           if (current_low <= zone_high && current_high >= zone_low)
           {
               is_touching = true;
           }
       }
       else // OP_BUYï¼Œæ£€æŸ¥çœ‹æ¶¨ä¿¡å·ï¼ˆä»·æ ¼ä»ä¸‹æ–¹è¿›å…¥æˆ–ç©¿è¿‡åŒºåŸŸï¼‰
       {
           // æ£€æŸ¥ï¼šKçº¿çš„ High æ˜¯å¦é«˜äºåŒºåŸŸçš„ Low (å³è¿›å…¥åŒºåŸŸ)ï¼ŒåŒæ—¶ Kçº¿çš„ Low å¿…é¡»ä½äºåŒºåŸŸçš„ High
           if (current_high >= zone_low && current_low <= zone_high)
           {
               is_touching = true;
           }
       }
       
       // âš ï¸ æ³¨æ„ï¼šä¸ºäº†ç®€åŒ–ä¸”ç¬¦åˆæ‚¨çš„â€œè§¦ç¢°â€éœ€æ±‚ï¼Œæˆ‘ä»¬å°†å®¹å·®é€»è¾‘ç§»é™¤ï¼Œåªæ£€æŸ¥ä»·æ ¼åŒºé—´äº¤å‰ã€‚
       // ä¹Ÿå¯ä»¥å°†å®¹å·®åº”ç”¨äº zone_low/zone_high çš„è¾¹ç•Œè®¡ç®—ã€‚æ­¤å¤„ä¿æŒç®€åŒ–äº¤å‰æ£€æŸ¥ã€‚
       
       if (is_touching)
       {
           // åªè¦è½å…¥ä»»ä½•ä¸€ä¸ªæœ‰æ•ˆåŒºåŸŸï¼Œç«‹å³è¿”å› true
           string type_str = (current_type == OP_SELL) ? "çœ‹è·Œ" : "çœ‹æ¶¨";
           Print("âœ… L2c æ–æ³¢è¿‡æ»¤é€šè¿‡: å½“å‰", type_str, "ä¿¡å· Kçº¿ (", TimeToString(Time[current_shift]), ") è§¦ç¢°äº† Fib [", DoubleToString(level1, 3), "-", DoubleToString(level2, 3), "] åŒºåŸŸã€‚");
           return true; 
       }
   }
   
   // 7. å¦‚æœéå†å®Œæ‰€æœ‰åŒºåŸŸéƒ½æ²¡æœ‰å‘½ä¸­ï¼Œåˆ™è¿”å› false
   return false;
}