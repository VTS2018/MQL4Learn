/*
    æ¡ä»¶: é˜´çº¿ï¼Œä¸”æ”¶ç›˜ä»·æ˜¯å·¦å³ä¸¤ä¾§å‘¨æœŸå†…çš„æœ€ä½æ”¶ç›˜ä»·ã€‚
    ä¼˜åŒ–: å¢åŠ è·³ç©ºè±å…æœºåˆ¶ï¼Œå…è®¸ç´§éšå…¶åçš„Kçº¿ (k=1) å› è·³ç©ºä½ä½æ¢åº•è€Œæ”¶ç›˜ä»·æ›´ä½ã€‚
*/
bool CheckKTargetBottomCondition(int i, int total_bars)
{
    // 1. å¿…é¡»æ˜¯é˜´çº¿ (Bearish Candle)
    // ç¡®ä¿ä½¿ç”¨ Lookahead/Lookback çš„æœ€æ–°å‚æ•°å€¼
    TuningParameters p = Smart_Tuning_Enabled ? GetTunedParameters() : 
                         TuningParameters {0, Lookahead_Bottom, Lookback_Bottom, 0, 0, 0}; 

    if (Close[i] >= Open[i]) return false;
    
    // --- æ£€æŸ¥å³ä¾§ (æœªæ¥/è¾ƒæ–°çš„Kçº¿) ---
    for (int k = 1; k <= p.Lookahead_Bottom; k++)
    {
        int future_index = i - k; 
        if (future_index < 0) break; 
        
        // 1. æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ›´ä½çš„æ”¶ç›˜ä»·
        if (Close[future_index] < Close[i])
        {
            // 2. ğŸš¨ è±å…æ¡ä»¶ ğŸš¨
            // åªæœ‰å½“å®ƒæ˜¯ç´§éšé”šç‚¹ (k=1) ä¸”å…¶ Low ä»·æ ¼å·²ç»çªç ´é”šç‚¹ Close æ—¶ï¼Œæ‰å…è®¸å…¶æ”¶ç›˜ä»·æ›´ä½ã€‚
            if (k == 1 && Low[future_index] < Close[i])
            {
                // æ»¡è¶³è±å…æ¡ä»¶ (å…¸å‹çš„è·³ç©ºä½ä½æ¢åº•)ï¼Œç»§ç»­æ£€æŸ¥åé¢çš„ K çº¿ (i-2, i-3...)
                continue; 
            }
            
            // 3. ä¸æ»¡è¶³è±å…æ¡ä»¶ (å³ k > 1 æˆ– k=1 ä½†æ²¡æœ‰ä½ä½æ¢åº•/è·³ç©º)ï¼Œ
            // ä¸”æ”¶ç›˜ä»·æ›´ä½ï¼Œåˆ™é”šç‚¹ i æ— æ•ˆã€‚
            return false;
        }
    }
    
    // --- æ£€æŸ¥å·¦ä¾§ (å†å²/è¾ƒæ—§çš„Kçº¿) ---
    // å·¦ä¾§ï¼ˆå†å² K çº¿ï¼‰ä¸æ¶‰åŠè·³ç©ºé—®é¢˜ï¼Œé€»è¾‘ä¿æŒä¸å˜ã€‚
    for (int k = 1; k <= p.Lookback_Bottom; k++)
    {
        int past_index = i + k; 
        if (past_index >= total_bars) break; 
        // å¿…é¡»æ˜¯æœ€ä½æ”¶ç›˜ä»·
        if (Close[past_index] < Close[i]) return false;
    }
    
    return true;
}