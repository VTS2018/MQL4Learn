//+------------------------------------------------------------------+
//| ä¿¡å·å¼±åŠ¿è¿‡æ»¤ (çœ‹æ¶¨ - æ–°ä½ä¼˜èƒœé€»è¾‘)                              |
//| ä¿®æ­£ï¼šå°†åˆå§‹æ¯”è¾ƒåŸºå‡†ä»æ”¶ç›˜ä»·æ”¹ä¸ºæœ€ä½æ­¢æŸä»· (ä½ç½®/é£é™©ä¼˜å…ˆ)        |
//| é€»è¾‘ï¼šä»æœ€æ–°ä¿¡å·å¼€å§‹å¾€å†å²å›æº¯ã€‚                                 |
//|      å¦‚æœ Newer.SL < Older.SLï¼Œåˆ™ Older æ— æ•ˆ (è¢«æ–°ä½å–ä»£)ã€‚      |
//|      å¦‚æœ Newer.SL >= Older.SLï¼Œåˆ™ Older æœ‰æ•ˆ (æ”¯æ’‘æœ‰æ•ˆ)ã€‚       |
//+------------------------------------------------------------------+
int FilterWeakBullishSignals(FilteredSignal &source_signals[], FilteredSignal &filtered_list[])
{
    // 1. åˆå§‹åŒ–
    ArrayResize(filtered_list, 0);
    int total = ArraySize(source_signals);
    
    if (total == 0) return 0;

    // 2. æ€»æ˜¯ä¿ç•™æœ€æ–°çš„ä¿¡å· (ç´¢å¼• 0ï¼Œå³ shift æœ€å°çš„ä¿¡å·)
    ArrayResize(filtered_list, 1);
    filtered_list[0] = source_signals[0];

    // -----------------------------------------------------------------
    // ğŸš¨ ä¿®æ­£ç‚¹ 1ï¼šå°†æ¯”è¾ƒåŸºå‡†ä»æ”¶ç›˜ä»·æ”¹ä¸ºæœ€ä½æ­¢æŸä»· ğŸš¨
    // 3. è®¾å®šåˆå§‹æ¯”è¾ƒåŸºå‡†ï¼šä½¿ç”¨æœ€æ–°ä¿¡å·çš„ã€æœ€ä½æ­¢æŸä»·ã€‘(stop_loss)
    //    æˆ‘ä»¬å°†å®ƒå‘½åä¸º threshold_sl ä»¥æ˜ç¡®å…¶å«ä¹‰ã€‚
    // -----------------------------------------------------------------
    double threshold_sl = source_signals[0].stop_loss; 

    // 4. å‘å†å²æ–¹å‘éå† (ä»ç´¢å¼• 1 å¼€å§‹ï¼Œå³æ¬¡æ–°çš„ä¿¡å·)
    for (int i = 1; i < total; i++)
    {
        FilteredSignal older_signal = source_signals[i];
        
        // -------------------------------------------------------------
        // ğŸš¨ æ ¸å¿ƒé€»è¾‘ï¼šæ–°ä½ä¼˜èƒœ ğŸš¨
        // æ¯”è¾ƒï¼šæœ€æ–°æœ‰æ•ˆä¿¡å·çš„ SL vs å†å²ä¿¡å·çš„ SL
        // -------------------------------------------------------------
        
        // æƒ…å†µ A: æ–°ä½å–ä»£ (New Low Precedence)
        // å¦‚æœè¾ƒæ–°çš„ SL ä»·æ ¼ ä½äº å†å²ä¿¡å·çš„ SL 
        // è¯´æ˜æœ€æ–°ä¿¡å·å·²ç»åˆ›å»ºäº†æ–°ä½ç»“æ„ï¼Œä½ç½®æ›´å·®/é£é™©æ›´ä¼˜ï¼Œæ—§ä¿¡å·åº”è¯¥è¢«æœ€æ–°çš„ä¿¡å·å–ä»£ã€‚
        if (threshold_sl < older_signal.stop_loss) // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬å°†åŸæ¥çš„ threshold_close æ›¿æ¢ä¸º threshold_sl
        {
            // Print("âŒ è¿‡æ»¤ (çœ‹æ¶¨): å†å²ä¿¡å· K[", older_signal.shift, "] SL:", older_signal.stop_loss, 
            //       " è¢«è¾ƒæ–°ä¿¡å· SL:", threshold_sl, " æ–°ä½ä¼˜èƒœå–ä»£ã€‚æ’é™¤ã€‚");
            
            // æ’é™¤è¯¥ä¿¡å·ï¼Œç»§ç»­å¾ªç¯ã€‚
            continue;
        }

        // æƒ…å†µ B: æ”¯æ’‘æœ‰æ•ˆ (Validation)
        // å¦‚æœè¾ƒæ–°çš„ SL ä»·æ ¼ é«˜äºæˆ–ç­‰äº å†å²ä¿¡å·çš„ SL
        // è¯´æ˜æœ€æ–°ä¿¡å·æ²¡æœ‰åˆ›å»ºæ›´ä½çš„ä»·æ ¼ï¼ˆå³æ²¡æœ‰æ–°ä½ï¼‰ï¼Œè€ä¿¡å·çš„ç»“æ„å®Œæ•´æ€§ä¾ç„¶æœ‰æ•ˆã€‚
        // å› æ­¤ï¼Œè¿™ä¸ªè€ä¿¡å·å¯ä»¥ä½œä¸ºæ¬¡ä¼˜å…¥åœºæˆ–ç»“æ„æ”¯æ’‘è¢«ä¿ç•™ã€‚
        filtered_list[ArraySize(filtered_list)] = older_signal;
        ArrayResize(filtered_list, ArraySize(filtered_list) + 1);
    }
    
    // Print("âœ… è¿‡æ»¤å®Œæˆï¼Œä¿ç•™ä¿¡å·æ•°: ", ArraySize(filtered_list));
    return ArraySize(filtered_list);
}