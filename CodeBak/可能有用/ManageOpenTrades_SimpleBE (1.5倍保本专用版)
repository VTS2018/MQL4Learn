//+------------------------------------------------------------------+
//| ManageOpenTrades_SimpleBE (1.5å€ä¿æœ¬ä¸“ç”¨ç‰ˆ)
//| ç­–ç•¥ï¼š
//| 1. ä¸è¿›è¡Œè¿½è¸ªæ­¢æŸ (ç»™è¶³ 1:2.5 çš„æ³¢åŠ¨ç©ºé—´)
//| 2. ä»…å½“ç›ˆåˆ©è¾¾åˆ° 1.5å€ åˆå§‹æ­¢æŸè·ç¦»æ—¶ï¼Œç§»åŠ¨æ­¢æŸåˆ°å¼€ä»“ä»· (BreakEven)
//+------------------------------------------------------------------+
void ManageOpenTrades_SimpleBE()
{
   // å¦‚æœæ€»å¼€å…³å…³é—­ï¼Œä¸ç®¡ç†
   if (!EA_Master_Switch) return;

   int total = OrdersTotal();
   for (int i = 0; i < total; i++)
   {
      // å¿…é¡»å¾ªç¯æŸ¥æ‰¾ï¼Œé˜²æ­¢æ¼å•
      if (OrderSelect(i, SELECT_BY_POS, MODE_TRADES) == false) continue;
      
      // è¿‡æ»¤ï¼šåªç®¡ç†æœ¬EAã€æœ¬å“ç§çš„è®¢å•
      if (OrderSymbol() != Symbol() || OrderMagicNumber() != MagicNumber) continue;
      
      // ---------------------------------------------------
      // æ ¸å¿ƒè®¡ç®—ï¼šè®¡ç®—åˆå§‹é£é™©è·ç¦» (Initial Risk)
      // ---------------------------------------------------
      double open_price = OrderOpenPrice();
      double current_sl = OrderStopLoss();
      
      // å¦‚æœæ²¡æœ‰æ­¢æŸï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè·³è¿‡ (é˜²æ­¢é™¤é›¶æˆ–é€»è¾‘é”™è¯¯)
      if (current_sl == 0) continue;
      
      // æ£€æŸ¥æ˜¯å¦å·²ç»ä¿æœ¬äº†ï¼Ÿ
      // å¦‚æœ Buyå• SL >= å¼€ä»“ä»·ï¼Œæˆ–è€… Sellå• SL <= å¼€ä»“ä»·ï¼Œè¯´æ˜å·²ç»ä¿æœ¬è¿‡äº†ï¼Œç›´æ¥è·³è¿‡
      // ä½¿ç”¨ Point * 0.5 ä½œä¸ºè¯¯å·®å®¹å¿
      if (OrderType() == OP_BUY && current_sl >= open_price - Point * 0.5) continue;
      if (OrderType() == OP_SELL && current_sl <= open_price + Point * 0.5) continue;

      // è®¡ç®—åˆå§‹æ­¢æŸçš„è·ç¦» (Risk Distance)
      // æ³¨æ„ï¼šè¿™é‡Œå‡è®¾å½“å‰çš„ SL è¿˜æ˜¯åˆå§‹ SLã€‚å› ä¸ºæˆ‘ä»¬åªç§»åŠ¨ä¸€æ¬¡ä¿æœ¬ï¼Œæ‰€ä»¥é€»è¾‘æˆç«‹ã€‚
      double risk_dist = MathAbs(open_price - current_sl);
      
      // è®¾å®šä¿æœ¬è§¦å‘çº¿ï¼š1.5 å€é£é™©
      double trigger_dist = risk_dist * 1.5;

      // ---------------------------------------------------
      // æ‰§è¡Œä¿æœ¬é€»è¾‘
      // ---------------------------------------------------
      if (OrderType() == OP_BUY)
      {
         double current_profit_dist = Bid - open_price;
         
         // å¦‚æœå½“å‰ç›ˆåˆ©è·ç¦» > 1.5å€é£é™©è·ç¦»
         if (current_profit_dist > trigger_dist)
         {
            // ç§»åŠ¨æ­¢æŸåˆ°å¼€ä»“ä»· (å¾®åŠ  1ä¸ªç‚¹é˜²æ­¢æ‰‹ç»­è´¹äºæŸï¼Œå¯é€‰)
            double new_sl = open_price; 
            
            if (OrderModify(OrderTicket(), open_price, new_sl, OrderTakeProfit(), 0, clrBlue))
            {
               Print("ğŸ›¡ï¸ [ä¿æœ¬è§¦å‘] è®¢å• #", OrderTicket(), 
                     " ç›ˆåˆ©è¾¾æ ‡ (1.5R: ", DoubleToString(current_profit_dist, 5), 
                     ") -> SL ç§»åŠ¨è‡³å¼€ä»“ä»·ã€‚");
            }
         }
      }
      else if (OrderType() == OP_SELL)
      {
         double current_profit_dist = open_price - Ask;
         
         // å¦‚æœå½“å‰ç›ˆåˆ©è·ç¦» > 1.5å€é£é™©è·ç¦»
         if (current_profit_dist > trigger_dist)
         {
            // ç§»åŠ¨æ­¢æŸåˆ°å¼€ä»“ä»·
            double new_sl = open_price;
            
            if (OrderModify(OrderTicket(), open_price, new_sl, OrderTakeProfit(), 0, clrRed))
            {
               Print("ğŸ›¡ï¸ [ä¿æœ¬è§¦å‘] è®¢å• #", OrderTicket(), 
                     " ç›ˆåˆ©è¾¾æ ‡ (1.5R: ", DoubleToString(current_profit_dist, 5), 
                     ") -> SL ç§»åŠ¨è‡³å¼€ä»“ä»·ã€‚");
            }
         }
      }
   }
}