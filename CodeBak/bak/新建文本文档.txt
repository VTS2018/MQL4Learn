//+------------------------------------------------------------------+
//| ä¿¡å·å¼±åŠ¿è¿‡æ»¤ (çœ‹æ¶¨ - æ–°ä½ä¼˜èƒœé€»è¾‘)                              |
//| é€»è¾‘ï¼šä»æœ€æ–°ä¿¡å·å¼€å§‹å¾€å†å²å›æº¯ã€‚                                 |
//|      å¦‚æœ Newer.Close < Older.SLï¼Œåˆ™ Older æ— æ•ˆ (è¢«å‡»ç©¿)ã€‚       |
//|      å¦‚æœ Newer.Close >= Older.SLï¼Œåˆ™ Older æœ‰æ•ˆ (æ”¯æ’‘æœ‰æ•ˆ)ã€‚    |
//+------------------------------------------------------------------+
int FilterWeakBullishSignals(FilteredSignal &source_signals[], FilteredSignal &filtered_list[])
{
    // 1. åˆå§‹åŒ–
    ArrayResize(filtered_list, 0);
    int total = ArraySize(source_signals);
    
    if (total == 0) return 0;

    // 2. æ€»æ˜¯ä¿ç•™æœ€æ–°çš„ä¿¡å· (ç´¢å¼• 0ï¼Œå³ shift æœ€å°çš„ä¿¡å·)
    // å› ä¸ºå®ƒæ˜¯ç¦»ç°ä»·æœ€è¿‘çš„å¸‚åœºäº‹å®ï¼Œæ— è®ºå®ƒé•¿ä»€ä¹ˆæ ·ï¼Œå®ƒéƒ½æ˜¯æœ€æ–°çš„å‚è€ƒç‚¹
    ArrayResize(filtered_list, 1);
    filtered_list[0] = source_signals[0];

    // 3. è®¾å®šåˆå§‹æ¯”è¾ƒåŸºå‡†ï¼šä½¿ç”¨æœ€æ–°ä¿¡å·çš„ã€æ”¶ç›˜ä»·ã€‘
    double threshold_close = source_signals[0].confirmation_close;

    // 4. å‘å†å²æ–¹å‘éå† (ä»ç´¢å¼• 1 å¼€å§‹ï¼Œå³æ¬¡æ–°çš„ä¿¡å·)
    for (int i = 1; i < total; i++)
    {
        FilteredSignal older_signal = source_signals[i];
        
        // -------------------------------------------------------------
        // ğŸš¨ æ ¸å¿ƒé€»è¾‘ï¼šæ–°ä½ä¼˜èƒœ ğŸš¨
        // æ¯”è¾ƒï¼šæœ€æ–°æœ‰æ•ˆä¿¡å·çš„ Close vs å†å²ä¿¡å·çš„ SL
        // -------------------------------------------------------------
        
        // æƒ…å†µ A: å‡»ç©¿ (Invalidation)
        // å¦‚æœè¾ƒæ–°çš„ Close ä»·æ ¼ ä½äº å†å²ä¿¡å·çš„ SL (æœ€ä½ä»·)
        // è¯´æ˜æœ€æ–°çš„ä»·æ ¼å·²ç»æ‰“ç ´äº†è¯¥å†å²ä¿¡å·çš„ç»“æ„ï¼Œè¯¥å†å²ä¿¡å·å¤±æ•ˆã€‚
        if (threshold_close < older_signal.stop_loss)
        {
            // Print("âŒ è¿‡æ»¤ (çœ‹æ¶¨): å†å²ä¿¡å· K[", older_signal.shift, "] SL:", older_signal.stop_loss, 
            //       " è¢«è¾ƒæ–°ä¿¡å· Close:", threshold_close, " å‡»ç©¿ã€‚æ’é™¤ã€‚");
            
            // æ’é™¤è¯¥ä¿¡å·ï¼Œç»§ç»­å¾ªç¯ã€‚
            // é˜ˆå€¼ threshold_close ä¿æŒä¸å˜ (ç»§ç»­ç”¨è¾ƒæ–°çš„è¿™ä¸ªä½ä»·å»æ£€éªŒæ›´è€çš„ä¿¡å·)
            continue;
        }

        // æƒ…å†µ B: æ”¯æ’‘æœ‰æ•ˆ (Validation)
        // å¦‚æœè¾ƒæ–°çš„ Close ä»·æ ¼ é«˜äºæˆ–ç­‰äº å†å²ä¿¡å·çš„ SL
        // è¯´æ˜è™½ç„¶å¯èƒ½æœ‰å›è°ƒï¼Œä½†æ²¡æœ‰æ‰“ç©¿è¯¥å†å²ä¿¡å·çš„åº•ï¼Œè¯¥å†å²ä¿¡å·ä¾ç„¶ä½œä¸ºé˜¶æ¢¯å­˜åœ¨ã€‚
        
        // åŠ å…¥æœ‰æ•ˆåˆ—è¡¨
        int new_index = ArraySize(filtered_list);
        ArrayResize(filtered_list, new_index + 1);
        filtered_list[new_index] = older_signal;

        // ğŸš¨ å…³é”®æ›´æ–°ï¼šæ—¢ç„¶è¿™ä¸ªå†å²ä¿¡å·æœ‰æ•ˆï¼Œå®ƒå°±æˆä¸ºæ›´æ—©ä¿¡å·çš„éªŒè¯è€… ğŸš¨
        // æˆ‘ä»¬æ›´æ–°é˜ˆå€¼ä¸ºè¿™ä¸ªå†å²ä¿¡å·çš„ Close
        threshold_close = older_signal.confirmation_close;
    }

    // è¿™é‡Œçš„ filtered_list é¡ºåºå·²ç»æ˜¯ï¼šæœ€æ–° -> è¾ƒæ–° -> è€ -> æœ€è€
    // ç¬¦åˆæ‚¨ K[1] å¾€å·¦å¯»æ‰¾çš„ç›´è§‰ï¼Œä¸éœ€è¦ ArrayReverseã€‚
    
    return ArraySize(filtered_list);
}