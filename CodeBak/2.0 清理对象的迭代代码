//========================================================================
// 2. OnDeinit: æŒ‡æ ‡å¸è½½æ—¶è°ƒç”¨ (æ¸…ç†å›¾è¡¨å¯¹è±¡)
//========================================================================
void OnDeinit(const int reason)
{
    // ... (å…¶ä»–ä¸å˜çš„ä»£ç ) ...
    
    if (!Is_EA_Mode)
    {
        // ------------------- 2.0 æ¸…ç†å¯¹è±¡çš„è¿­ä»£ä»£ç  -------------------
        string obj_name;

        // éå†å›¾è¡¨ä¸Šçš„æ‰€æœ‰å¯¹è±¡ï¼Œä»åå‘å‰åˆ é™¤
        for (int i = ObjectsTotal() - 1; i >= 0; i--)
        {
            obj_name = ObjectName(i);

            // 1. æ£€æŸ¥å¯¹è±¡æ˜¯å¦ç”±æœ¬æŒ‡æ ‡åˆ›å»º (g_object_prefix å¿…é¡»ä»åç§°çš„ç¬¬ 0 ä½å¼€å§‹åŒ¹é…)
            if (StringFind(obj_name, g_object_prefix, 0) == 0)
            {
                // --- åˆ¤æ–­æ˜¯å¦ä¸º Fibo å¯¹è±¡ ---
                bool is_fibo_line = (StringFind(obj_name, "_Fibo_", 0) != -1);
                bool is_fibo_highlight = (StringFind(obj_name, "_FiboHL_", 0) != -1);
                bool is_fibo_text = (StringFind(obj_name, "_TXT", 0) != -1);
                
                // åªè¦åç§°ä¸­åŒ…å«ä»»æ„ Fibo å…³é”®å­—ï¼Œå°±è®¤ä¸ºæ˜¯éœ€è¦ä¿ç•™çš„å¯¹è±¡
                bool should_keep_fibo = is_fibo_line || is_fibo_highlight || is_fibo_text;

                // --- æ¸…ç†é€»è¾‘åˆ†æ”¯ ---

                // åœºæ™¯ A: åˆ‡æ¢å‘¨æœŸ (REASON_CHARTCHANGE = 5)
                // åœºæ™¯ B: å›¾è¡¨å…³é—­/MT4é€€å‡º (REASON_CLOSE = 2) ğŸš¨ ã€æ–°å¢åŠ çš„ä¿ç•™é€»è¾‘ã€‘
                if (reason == REASON_CHARTCHANGE || reason == REASON_CLOSE)
                {
                    // ä»…åˆ é™¤é Fibo å¯¹è±¡ï¼Œä¿ç•™æ‰€æœ‰ Fibo ç›¸å…³çš„å¯¹è±¡
                    if (!should_keep_fibo)
                    {
                        // åˆ é™¤é Fibo å¯¹è±¡ï¼ˆå¦‚çŸ©å½¢ã€åŸºå‡†çº¿ç­‰ï¼‰
                        ObjectDelete(0, obj_name);
                    }
                    // å¦åˆ™ï¼Œä¿ç•™å¯¹è±¡
                }
                
                // åœºæ™¯ C: æ‰‹åŠ¨åˆ é™¤æŒ‡æ ‡ (REASON_REMOVE = 1)
                // æ­¤æ—¶ç”¨æˆ·æ˜ç¡®è¦æ±‚ç§»é™¤æŒ‡æ ‡ï¼Œåº”è¯¥æ— æ¡ä»¶åˆ é™¤æ‰€æœ‰å¯¹è±¡
                else if (reason == REASON_REMOVE)
                {
                    ObjectDelete(0, obj_name);
                }
                
                // åœºæ™¯ D: å…¶ä»–åŸå›  (ä¾‹å¦‚ REASON_RECOMPILE)
                // é»˜è®¤åˆ é™¤æ‰€æœ‰é Fibo å¯¹è±¡ï¼Œé˜²æ­¢ç¼–è¯‘åå‡ºç°é‡å¤ç»˜åˆ¶ã€‚
                else
                {
                     if (!should_keep_fibo) ObjectDelete(0, obj_name);
                }
            }
        }
    }

    // ------------------- 0.0 ä¸‹é¢çš„ä»£ç ä¿æŒä¸å˜ -------------------
    ChartRedraw();
    Print("---->[KTarget_Finder5.mq4:249]: OnDeinit æŒ‡æ ‡å¸è½½ ");
}