//+------------------------------------------------------------------+
//|                                              Force_Clear_All.mq4 |
//|                                  Copyright 2025, K-Target System |
//|                                             https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright "K-Target User"
#property link      "https://www.mql5.com"
#property version   "1.00"
#property strict
#property show_inputs // 运行时弹出确认窗口 (如果想要一键秒删，可以将此行注释掉)

//+------------------------------------------------------------------+
//| 脚本程序输入参数
//+------------------------------------------------------------------+
input bool Confirm_Delete = true; // 是否弹出确认 (True=确认, False=直接删)

//+------------------------------------------------------------------+
//| 脚本程序起始函数
//+------------------------------------------------------------------+
void OnStart()
{
   // 1. 安全确认环节 (防止手滑误删)
   if(Confirm_Delete)
   {
      int ret = MessageBox("确定要清除主图表上的【所有】绘图对象吗？\n\n这包括：\n1. 手动绘制的趋势线/矩形\n2. 隐藏的系统对象\n3. 其他指标生成的箭头或标记", 
                           "强力清除确认", 
                           MB_YESNO | MB_ICONWARNING);
      
      if(ret == IDNO) 
      {
         Print("操作已取消。");
         return;
      }
   }

   // 2. 核心清除逻辑
   // 参数说明: 
   // chart_id = 0 (当前图表)
   // sub_window = -1 (所有窗口，包括主图和副图指标窗口)
   // type = -1 (所有类型的对象，包括线、箭头、文字、位图等)
   // -----------------------------------------------------------
   int total_deleted = ObjectsDeleteAll(0, -1, -1);
   
   // 3. 强制刷新图表
   // 这一步很重要，确保视觉上立即消失，而不是等到下一个Tick
   ChartRedraw(0);
   
   // 4. 打印日志
   if(total_deleted > 0)
      Print(" 成功清除了 ", total_deleted, " 个对象 (包含隐藏对象)。");
   else
      Print(" 图表上没有发现可删除的对象。");
}
//+------------------------------------------------------------------+